# quote-bot
Telegram бот конструктор цитат для Гражданского Общества

## Установка зависимостей и запуск

Создайте новое python окружение и выполните
```
pip install poetry
poetry install --no-root
pre-commit install
poetry run bot
```

Файл .env должен лежать в корне проекта:
```
TOKEN="Ваш токен Telegram"
```
Либо переменная окружения TOKEN должна быть задана

Перед новым коммитом запускайте `make pre-commit`

## Привязка к чату

Права доступа к боту ограничены. Только пользователи, которые есть в чате, могут создавать цитаты.
Только администраторы чата могут добавлять и удалять шаблоны для плакатов.
Чтобы привязать бота к чату нужно:
* Добавить бота в чат (без прав администратора)
* Отправить в чате команду боту /chat_id
* Посмотреть идентификатор чата в ответном сообщении от бота
* Идентификатор чата записать в файле settings.py
```python
    @classmethod
    def access_chat_id(cls) -> int:
        return -1001306836357  # Идентификатор чата
```

## Разворачивание на AWS (для разработчиков)

TODO: нормальная инструкция

Помощь:
https://github.com/DavisDmitry/aiogram-aws-serverless-example
https://github.com/marcmetz/How-To-Create-AWS-Lambda-Function-with-Docker

Для работы на AWS нужны Layout (слой с пакетами) и собственно бот. За сборку этих двух отвечает скрипт build_aws.sh
Его нужно запускать от root, потому что внутри себя он использует Docker
Архив aws-layout нужно поместить в облако и создать из него Python3.7 layout
Архив aws нужно поместить в lambda, добавить созданный aws layout
Прочие настройки из инструкции выше